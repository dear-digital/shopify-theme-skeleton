<div class="slideshow relative {{section.settings.slideshow}}">
  {% if section.blocks.size == 0 %}
    <div class="slide {{section.settings.slide}}">
      <a href="#">No Announcements</a>
    </div>
  {% else %}
    {% for block in section.blocks %}
      <div class="slide {{section.settings.slide}}">
        <a href="{{block.settings.link}}">{{ block.settings.text }}</a>
      </div>
    {% endfor %}
    {% if section.blocks.size > 0 %}
      <a
        class="control control--prev prev {{section.settings.controlPrev}}"
        onclick="plusSlides(-1)"
        >&larr;</a
      >
      <a
        class="control control--next next {{section.settings.controlNext}}"
        onclick="plusSlides(1)"
        >&rarr;</a
      >
    {% endif %}
  {% endif %}
</div>

<script>
  let slideIndex = 1;
  let autoRotateInterval = {{ section.settings.auto_rotate_interval | default: 0 }} * 1000; // Convert seconds to milliseconds
  let autoRotateTimer;

  showSlides(slideIndex);

  function plusSlides(n) {
    clearTimeout(autoRotateTimer);
    showSlides((slideIndex += n));
  }

  function currentSlide(n) {
    clearTimeout(autoRotateTimer);
    showSlides((slideIndex = n));
  }

  function showSlides(n) {
    let i;
    let slides = document.getElementsByClassName('slide');
    if (n > slides.length) {
      slideIndex = 1;
    }
    if (n < 1) {
      slideIndex = slides.length;
    }
    for (i = 0; i < slides.length; i++) {
      slides[i].style.display = 'none';
    }
    slides[slideIndex - 1].style.display = 'block';

    if (autoRotateInterval > 0) {
      autoRotateTimer = setTimeout(() => {
        plusSlides(1);
      }, autoRotateInterval);
    }
  }
</script>

{% schema %}
{
  "name": "Announcement Bar",
  "enabled_on": { "groups": ["header"] },
  "settings": [
    {
      "type": "range",
      "id": "auto_rotate_interval",
      "label": "Auto-Rotate Interval (seconds)",
      "min": 0,
      "max": 5,
      "step": 1,
      "default": 0,
      "info": "Set to 0 to disable the slideshow. Remember to save the theme after making changes."
    },
    {
      "type": "header",
      "content": "Tailwind Styling Classes"
    },
    {
      "type": "textarea",
      "id": "slideshow",
      "label": "Slideshow Main Container",
      "default": "bg-black m-0 select-none"
    },
    {
      "type": "textarea",
      "id": "slide",
      "label": "Slide",
      "default": "none p-3 text-center text-white font-bold italic"
    },
    {
      "type": "textarea",
      "id": "controlPrev",
      "label": "Control Prev",
      "default": "absolute cursor-pointer top-2/4 w-auto -mt-8 p-4 text-[#888] font-bold text-xl text-white"
    },
    {
      "type": "textarea",
      "id": "controlNext",
      "label": "Control Next",
      "default": "absolute cursor-pointer top-2/4 w-auto -mt-8 p-4 text-[#888] font-bold text-xl text-white right-0"
    }
  ],
  "blocks": [
    {
      "type": "announcement",
      "name": "Text",
      "settings": [
        {
          "type": "text",
          "id": "text",
          "label": "Text"
        },
        {
          "type": "url",
          "id": "link",
          "label": "Link"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Default",
      "category": "Announcement Bar",
      "blocks": [
        {
          "type": "announcement",
          "settings": {
            "text": "Announcement 1"
          }
        },
        {
          "type": "announcement",
          "settings": {
            "text": "Announcement 2"
          }
        },
        {
          "type": "announcement",
          "settings": {
            "text": "Announcement 3"
          }
        }
      ]
    }
  ]
}
{% endschema %}
